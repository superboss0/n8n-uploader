<script>
  const form = document.getElementById("uploadForm");
  const status = document.getElementById("status");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const fileInput = form.querySelector('input[type="file"]');
    const file = fileInput.files[0];

    if (!file) {
      status.textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.";
      return;
    }

    status.textContent = "üßæ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...";

    const formData = new FormData();
    formData.append("data", file);

    try {
      const response = await fetch("https://octopays.app.n8n.cloud/webhook-test/e199fa07-fb4c-4806-befe-e20a6df949ee", {
        method: "POST",
        body: formData,
      });

      if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏");

      const blob = await response.blob();
      const downloadUrl = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = downloadUrl;
      a.download = "reconciled.xlsx";
      document.body.appendChild(a);
      a.click();
      a.remove();

      status.textContent = "‚úÖ –§–∞–π–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ —Å–∫–∞—á–∞–Ω.";
    } catch (err) {
      console.error(err);
      status.textContent = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞.";
    }
  });
</script>
